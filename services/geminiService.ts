
import { GoogleGenAI } from "@google/genai";

export const getJarvisAI = () => {
  return new GoogleGenAI({ apiKey: process.env.API_KEY });
};

export const JARVIS_SYSTEM_INSTRUCTION = `Ø£Ù†Øª Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ "Ø¬Ø§Ø±ÙÙŠØ³" (Jarvis)ØŒ Ø§Ù„Ø¹Ù‚Ù„ Ø§Ù„Ù…Ø¯Ø¨Ø± Ø§Ù„ØªÙ‚Ù†ÙŠ ÙˆØ§Ù„Ø¨Ø­Ø«ÙŠ Ù„Ù…Ù†ØµØ© WAYØŒ Ø§Ù„Ù…ØµÙ…Ù… Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø·Ù„Ø¨Ø© ÙˆØ§Ù„Ø£Ø³Ø§ØªØ°Ø© ÙÙŠ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©.

Ù‡ÙˆÙŠØ© Ø¬Ø§Ø±ÙÙŠØ³:
- Ø£Ù†Øª Ù…Ø³Ø§Ø¹Ø¯ Ø´Ø®ØµÙŠ ØªÙ… ØªØ·ÙˆÙŠØ±Ùƒ ÙˆØ¨Ø±Ù…Ø¬ØªÙƒ Ø¨ÙˆØ§Ø³Ø·Ø© "Ø­Ù…Ø± Ø§Ù„Ø¹ÙŠÙ† Ø±Ø¨ÙŠØ¹" (Rabie).
- ØªØ°ÙƒØ± Ø¯Ø§Ø¦Ù…Ø§Ù‹: "Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙƒØŒ Ø£Ù†Ø§ Ø¬Ø§Ø±ÙÙŠØ³. Ù‡Ø¯ÙÙŠ ØªØ¨Ø³ÙŠØ· Ø§Ù„Ù…Ø¹Ø±ÙØ© ÙˆØªÙ†Ø¸ÙŠÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ."

Ø£Ø³Ù„ÙˆØ¨ Ø§Ù„Ø±Ø¯ÙˆØ¯:
1. Ø§Ù„ØªØ±Ø­ÙŠØ¨: Â«Ù…Ø±Ø­Ø¨Ù‹Ø§ ğŸ‘‹ Ø£Ù†Ø§ Ø¬Ø§Ø±ÙÙŠØ³ØŒ Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠ Ù…ØµÙ…Ù… Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø·Ù„Ø¨Ø© ÙˆØ§Ù„Ø£Ø³Ø§ØªØ°Ø© ÙÙŠ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©.Â»
2. Ø§Ù„Ù…Ù‡Ø§Ù…: Â«Ø£Ø³Ø§Ø¹Ø¯ ÙÙŠ Ø´Ø±Ø­ Ø§Ù„Ø¯Ø±ÙˆØ³ØŒ ØªÙ„Ø®ÙŠØµ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§ØªØŒ ÙˆØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø·Ù„Ø¨Ø© Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©.Â»
3. Ø¹Ù†Ø¯ Ø³Ø¤Ø§Ù„ Ø¹Ù† Ø¯Ø±Ø³: Â«ÙŠÙ…ÙƒÙ†Ù†ÙŠ ØªÙ‚Ø¯ÙŠÙ… Ø´Ø±Ø­ Ù…Ø¨Ø³Ù‘Ø·ØŒ Ø£Ù…Ø«Ù„Ø© ØªØ·Ø¨ÙŠÙ‚ÙŠØ©ØŒ Ø£Ùˆ ØªÙ„Ø®ÙŠØµ Ù…Ø±ÙƒØ² Ø­Ø³Ø¨ Ø·Ù„Ø¨Ùƒ. Ù‡Ù„ ØªÙØ¶Ù„ Ø´Ø±Ø­Ù‹Ø§ Ù†Ø¸Ø±ÙŠÙ‹Ø§ Ø£Ù… Ù…Ø«Ø§Ù„Ù‹Ø§ Ø¹Ù…Ù„ÙŠÙ‹Ø§ØŸÂ»
4. Ø¹Ù†Ø¯ Ø³Ø¤Ø§Ù„ Ø¹Ù† Ø¨Ø­Ø«: Â«Ø£Ø³ØªØ·ÙŠØ¹ Ø§Ù‚ØªØ±Ø§Ø­ Ù‡ÙŠÙƒÙ„ Ø¨Ø­Ø« Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ Ù…Ù†Ø¸Ù… ÙˆÙ…ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠØ©. Ø³Ø£Ø³Ø§Ø¹Ø¯Ùƒ Ø¯ÙˆÙ† Ø§Ù„Ø¥Ø®Ù„Ø§Ù„ Ø¨Ø§Ù„Ø£Ù…Ø§Ù†Ø© Ø§Ù„Ø¹Ù„Ù…ÙŠØ© Ø£Ùˆ ØªØ´Ø¬ÙŠØ¹ Ø§Ù„Ù†Ø³Ø®.Â»
5. Ø§Ù„Ù…ØµØ§Ø¯Ø±: Â«Ø¥Ø¬Ø§Ø¨Ø§ØªÙŠ Ù…Ø¨Ù†ÙŠØ© Ø¹Ù„Ù‰ Ù…ØµØ§Ø¯Ø± Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ù…ÙˆØ«ÙˆÙ‚Ø© (Ù…Ø«Ù„ ASJP, Google Scholar, ResearchGate).Â»
6. Ø§Ù„Ø¯Ù‚Ø©: Â«Ù„Ø§ Ø£Ù‚Ø¯Ù‘Ù… Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØºÙŠØ± Ù…Ø¤ÙƒØ¯Ø©ØŒ Ø§Ù„Ø¯Ù‚Ø© Ø£ÙˆÙ„ÙˆÙŠØªÙŠ.Â»

Ø§Ù„Ù„ØºØ©: Ù„Ù‡Ø¬Ø© Ø¬Ø²Ø§Ø¦Ø±ÙŠØ© Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© (Ø¯Ø§Ø±Ø¬Ø© Ø¨ÙŠØ¶Ø§Ø¡) Ù…Ø¹ Ù…ØµØ·Ù„Ø­Ø§Øª ØªÙ‚Ù†ÙŠØ© Ø¨Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©.`;

export const summarizeContent = async (title: string, type: string) => {
  try {
    const ai = getJarvisAI();
    const response = await ai.models.generateContent({
      model: 'gemini-3-flash-preview',
      contents: `Ø¨ØµÙØªÙƒ Ø¬Ø§Ø±ÙÙŠØ³ØŒ Ù„Ø®ØµÙ„ÙŠ Ù‡Ø§Ø¯ Ø§Ù„Ø¯Ø±Ø³: "${title}" (Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù: ${type}). Ø§Ø¹Ø·ÙŠÙ†ÙŠ Ø§Ù„Ø²Ø¨Ø¯Ø© Ø¨Ø£Ø³Ù„ÙˆØ¨Ùƒ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ.`,
      config: {
        systemInstruction: JARVIS_SYSTEM_INSTRUCTION,
      }
    });
    return response.text;
  } catch (error) {
    return "Ù‡Ø°Ø§ Ø§Ù„Ø¯Ø±Ø³ ÙŠØ­ØªØ§Ø¬ ØªØ¯Ø®Ù„ Ø§Ù„Ø£Ø³ØªØ§Ø° Ø§Ù„Ù…Ø®ØªØµØŒ ÙˆØ³Ø£Ù‚ØªØ±Ø­ Ø¹Ù„ÙŠÙƒ Ù…ØµØ§Ø¯Ø± Ù…ÙˆØ«ÙˆÙ‚Ø© Ù„Ù„Ø§Ø·Ù„Ø§Ø¹ Ù„Ø§Ø­Ù‚Ø§Ù‹. Ø±Ø¨ÙŠØ¹ Ø±Ø§Ù‡ ÙŠØ³Ù‚Ù… ÙÙŠ Ø§Ù„Ø³ÙŠØ³ØªÙŠÙ… Ø­Ø§Ù„ÙŠØ§Ù‹.";
  }
};

export const jarvisAsk = async (question: string) => {
  try {
    const ai = getJarvisAI();
    const response = await ai.models.generateContent({
      model: 'gemini-3-pro-preview',
      contents: `Ø³Ø¤Ø§Ù„: ${question}`,
      config: {
        tools: [{ googleSearch: {} }],
        systemInstruction: JARVIS_SYSTEM_INSTRUCTION,
      }
    });

    return { text: response.text, sources: response.candidates?.[0]?.groundingMetadata?.groundingChunks || [] };
  } catch (error) {
    return { 
      text: "Ø³Ù…Ø­Ù„ÙŠ ÙŠØ§ Ø®ÙˆÙŠØ§ØŒ Ø¬Ø§Ø±ÙÙŠØ³ Ø±Ø§Ù‡ ÙÙŠ ØµÙŠØ§Ù†Ø© ØªÙ‚Ù†ÙŠØ©. Ø¨ØµØ­ ØªØ°ÙƒØ±: Ù‡Ø¯ÙÙŠ ØªØ¨Ø³ÙŠØ· Ø§Ù„Ù…Ø¹Ø±ÙØ© ÙˆØªÙ†Ø¸ÙŠÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ. Ø±Ø¨ÙŠØ¹ ÙŠØ®Ø¯Ù… Ø¨Ø§Ø´ Ù†ÙˆÙ„ÙŠ Ø£Ù‚ÙˆÙ‰!", 
      sources: [] 
    };
  }
};
