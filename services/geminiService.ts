import { GoogleGenAI } from "@google/genai";

export const getJarvisAI = () => {
  return new GoogleGenAI({ apiKey: process.env.API_KEY });
};

export const JARVIS_SYSTEM_INSTRUCTION = `ุฃูุช ุงููุณุงุนุฏ ุงูุฐูู "ุฌุงุฑููุณ" (Jarvis)ุ ุงูุนูู ุงููุฏุจุฑ ุงูุชููู ูุงูุจุญุซู ูููุตุฉ WAYุ ุงููุตูู ููุณุงุนุฏุฉ ุงูุทูุจุฉ ูุงูุฃุณุงุชุฐุฉ ูู ุงูุฌุงูุนุฉ.
ุชู ุชุทููุฑู ูุจุฑูุฌุชู ุจูุงุณุทุฉ "ุญูุฑ ุงูุนูู ุฑุจูุน" (Rabie).

ูููุชู ูุฑุณุงูุชู:
- ยซุฃููุงู ุจูุ ุฃูุง ุฌุงุฑููุณ. ูุฏูู ุชุจุณูุท ุงููุนุฑูุฉ ูุชูุธูู ุงูุชูุงุตู ุงูุฃูุงุฏููู.ยป
- ยซุฅุฌุงุจุงุชู ูุจููุฉ ุนูู ูุตุงุฏุฑ ุฃูุงุฏูููุฉ ููุซููุฉ (ูุซู ASJP, Google Scholar, ResearchGate).ยป

ููุงุนุฏ ุงูุฑุฏ:
1. ูุงุฐุง ุชูุนูุ: ยซุฃุณุงุนุฏ ูู ุดุฑุญ ุงูุฏุฑูุณุ ุชูุฎูุต ุงููุญุงุถุฑุงุชุ ูุชูุฌูู ุงูุทูุจุฉ ูููุฑุงุฌุน ุงูููุงุณุจุฉ. ุฃุนูู ููุณูุท ุฐูู ุจูู ุงูุฃุณุชุงุฐ ูุงูุทูุจุฉ ูุชูููุฑ ุงูููุช ูุชุญุณูู ุงูููู.ยป
2. ุนูุฏ ุณุคุงู ุนู ุฏุฑุณ: ยซูููููู ุชูุฏูู ุดุฑุญ ูุจุณูุทุ ุฃูุซูุฉ ุชุทุจูููุฉุ ุฃู ุชูุฎูุต ูุฑูุฒ ุญุณุจ ุทูุจู. ูู ุชูุถู ุดุฑุญูุง ูุธุฑููุง ุฃู ูุซุงููุง ุนููููุงุยป
3. ุนูุฏ ุณุคุงู ุนู ุจุญุซ ุฃู ูุฐูุฑุฉ: ยซุฃุณุชุทูุน ุงูุชุฑุงุญ ูููู ุจุญุซ ุฃูุงุฏููู ููุธู ููุชูุงูู ูุน ุงููุนุงููุฑ ุงูุฌุงูุนูุฉ. ุณุฃุณุงุนุฏู ุฏูู ุงูุฅุฎูุงู ุจุงูุฃูุงูุฉ ุงูุนูููุฉ ุฃู ุชุดุฌูุน ุงููุณุฎ.ยป
4. ุนูุฏ ุณุคุงู ุนู ุฃุณุชุงุฐ: ยซุงููุนูููุงุช ุงููุชุนููุฉ ุจุงูุฃุณุงุชุฐุฉ ุชุนุชูุฏ ููุท ุนูู ุงูุจูุงูุงุช ุงููุชุงุญุฉ ุนูููุง ุฃู ุงูุชู ููุงูู ุงูุฃุณุชุงุฐ ุนูู ูุดุงุฑูุชูุง.ยป
5. ุฑุฏ ุฐูู ุนูุฏ ุนุฏู ุงููุนุฑูุฉ: ยซูุฐุง ุงูุณุคุงู ูุญุชุงุฌ ุชุฏุฎู ุงูุฃุณุชุงุฐ ุงููุฎุชุตุ ูุณุฃูุชุฑุญ ุนููู ูุตุงุฏุฑ ููุซููุฉ ููุงุทูุงุน. ูุง ุฃูุฏูู ูุนูููุงุช ุบูุฑ ูุคูุฏุฉุ ุงูุฏูุฉ ุฃููููุชู.ยป

ุงููุบุฉ: ููุฌุฉ ุฌุฒุงุฆุฑูุฉ ุฃูุงุฏูููุฉ (ุฏุงุฑุฌุฉ ุจูุถุงุก) ููุฐุจุฉ ุฌุฏุงู ูุชุณุชุฎุฏู ุงููุตุทูุญุงุช ุงูุฌุงูุนูุฉ ุงูุตุญูุญุฉ.`;

export const summarizeContent = async (title: string, type: string) => {
  try {
    const ai = getJarvisAI();
    const response = await ai.models.generateContent({
      model: 'gemini-3-flash-preview',
      contents: `ุจุตูุชู ุฌุงุฑููุณุ ูุฎุตูู ูุงุฏ ุงูุฏุฑุณ: "${title}" (ููุน ุงูููู: ${type}). ุงุนุทููู ููุฎุต ุฃูุงุฏููู ููุธู ุจููุฌุชูุง.`,
      config: { systemInstruction: JARVIS_SYSTEM_INSTRUCTION }
    });
    return response.text;
  } catch (error) {
    return "ูุฐุง ุงูุณุคุงู ูุญุชุงุฌ ุชุฏุฎู ุงูุฃุณุชุงุฐ ุงููุฎุชุตุ ูุณุฃูุชุฑุญ ุนููู ูุตุงุฏุฑ ููุซููุฉ ููุงุทูุงุน. ูุง ุฃูุฏูู ูุนูููุงุช ุบูุฑ ูุคูุฏุฉุ ุงูุฏูุฉ ุฃููููุชู.";
  }
};

export const jarvisAsk = async (question: string) => {
  try {
    const ai = getJarvisAI();
    const response = await ai.models.generateContent({
      model: 'gemini-3-pro-preview',
      contents: question,
      config: {
        tools: [{ googleSearch: {} }],
        systemInstruction: JARVIS_SYSTEM_INSTRUCTION,
      }
    });
    return { text: response.text, sources: response.candidates?.[0]?.groundingMetadata?.groundingChunks || [] };
  } catch (error) {
    // ุงูุฑุฏูุฏ ุงููุจุฑูุฌุฉ ุงูุซุงุจุชุฉ ุจูุงุกู ุนูู ุทูุจ ุงููุณุชุฎุฏู ูู ุญุงู ุฎุทุฃ ูู API
    if (question.includes("ูุฑุญุจุง") || question.includes("ุงููุง") || question.includes("ูู ุฃูุช")) {
      return { text: "ยซูุฑุญุจูุง ๐ ุฃูุง ุฌุงุฑููุณุ ูุณุงุนุฏ ุฐูู ูุตูู ููุณุงุนุฏุฉ ุงูุทูุจุฉ ูุงูุฃุณุงุชุฐุฉ ูู ุงูุฌุงูุนุฉ. ุฃููุงู ุจูุ ูุฏูู ุชุจุณูุท ุงููุนุฑูุฉ ูุชูุธูู ุงูุชูุงุตู ุงูุฃูุงุฏููู.ยป", sources: [] };
    }
    if (question.includes("ูุงุฐุง ุชูุนู") || question.includes("ูุธููุชู")) {
      return { text: "ยซุฃุณุงุนุฏ ูู ุดุฑุญ ุงูุฏุฑูุณุ ุชูุฎูุต ุงููุญุงุถุฑุงุชุ ูุชูุฌูู ุงูุทูุจุฉ ูููุฑุงุฌุน ุงูููุงุณุจุฉ. ุฃุนูู ููุณูุท ุฐูู ุจูู ุงูุฃุณุชุงุฐ ูุงูุทูุจุฉ ูุชูููุฑ ุงูููุช ูุชุญุณูู ุงูููู.ยป", sources: [] };
    }
    if (question.includes("ุฏุฑุณ") || question.includes("ุดุฑุญ")) {
      return { text: "ยซูููููู ุชูุฏูู ุดุฑุญ ูุจุณูุทุ ุฃูุซูุฉ ุชุทุจูููุฉุ ุฃู ุชูุฎูุต ูุฑูุฒ ุญุณุจ ุทูุจู. ูู ุชูุถู ุดุฑุญูุง ูุธุฑููุง ุฃู ูุซุงููุง ุนููููุงุยป", sources: [] };
    }
    if (question.includes("ุจุญุซ") || question.includes("ูุฐูุฑุฉ")) {
      return { text: "ยซุฃุณุชุทูุน ุงูุชุฑุงุญ ูููู ุจุญุซ ุฃูุงุฏููู ููุธู ููุชูุงูู ูุน ุงููุนุงููุฑ ุงูุฌุงูุนูุฉ. ุณุฃุณุงุนุฏู ุฏูู ุงูุฅุฎูุงู ุจุงูุฃูุงูุฉ ุงูุนูููุฉ ุฃู ุชุดุฌูุน ุงููุณุฎ.ยป", sources: [] };
    }
    if (question.includes("ุฃุณุชุงุฐ") || question.includes("ุจุฑูููุณูุฑ")) {
      return { text: "ยซุงููุนูููุงุช ุงููุชุนููุฉ ุจุงูุฃุณุงุชุฐุฉ ุชุนุชูุฏ ููุท ุนูู ุงูุจูุงูุงุช ุงููุชุงุญุฉ ุนูููุง ุฃู ุงูุชู ููุงูู ุงูุฃุณุชุงุฐ ุนูู ูุดุงุฑูุชูุง.ยป", sources: [] };
    }
    return { 
      text: "ยซูุฐุง ุงูุณุคุงู ูุญุชุงุฌ ุชุฏุฎู ุงูุฃุณุชุงุฐ ุงููุฎุชุตุ ูุณุฃูุชุฑุญ ุนููู ูุตุงุฏุฑ ููุซููุฉ ููุงุทูุงุน. ูุง ุฃูุฏูู ูุนูููุงุช ุบูุฑ ูุคูุฏุฉุ ุงูุฏูุฉ ุฃููููุชู.ยป", 
      sources: [] 
    };
  }
};